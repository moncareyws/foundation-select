/**
 * Foundation select by Samuel Moncarey
 * Licensed under MIT Open Source
 */

$select-background: $input-background !default;
$select-color: $input-color !default;
$select-border: $input-border !default;
$select-shadow: $input-shadow !default;
$select-border-focus: $input-border-focus !default;
$select-shadow-focus: $input-shadow-focus !default;
$select-option-hover-color: $select-color !default;
$select-option-selected-color: $select-option-hover-color !default;
$select-option-hover-background: rgba($secondary-color, .15) !default;
$select-option-selected-background: $select-option-hover-background !default;
$select-optgroup-indent: 1.25em !default;
$select-dropdown-height: rem-calc(300) !default;
$select-multiple-size-default: 5 !default;
$select-multiple-size-max: 12 !default;

@function select-size-calc($size) {
  @return $size * ($form-spacing + ($input-font-size * $global-lineheight));
}

@mixin select-size-calc($size) {
  max-height: select-size-calc($size);
}

@mixin select-dropdown {
  background-color: $select-background;
  border: $select-border;
  box-shadow: $select-shadow;
  border-top: none;
  border-radius: 0 0 $select-radius $select-radius;
  display: block;
  position: absolute;
  visibility: hidden;
  width: 100%;
  z-index: 10;
  transition: border .4s;

  &.is-open {
    visibility: visible;
    border: $select-border-focus;
    box-shadow: $select-shadow-focus;
    border-top: none;
  }

  & > div {
    position: relative;
    max-height: $select-dropdown-height;

    ul {
      @include menu-base;
      @include menu-direction(vertical);
      li {
        a {
          color: $select-color;
          padding: $form-spacing / 2;
          font-size: $input-font-size;
          line-height: $global-lineheight;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
          &.selected {
            color: $select-option-selected-color;
            background: $select-option-selected-background;
          }
          &:not(.group-label) {
            &:hover, &:focus{
              color: $select-option-hover-color;
              background: $select-option-hover-background;
            }
          }

          &.group-label {
            font-weight: bold;
            font-size: 1.1em;

            & + ul {
              li a {
                padding-left: $select-optgroup-indent;
              }
            }
          }
        }
      }
    }
  }
}

@mixin select-container {
  position: relative;

  input {
    padding-right: rem-calc($input-font-size * $global-lineheight) + $form-spacing;
    background: $input-background;
    cursor: pointer;
    border-radius: $select-radius;
    &[aria-expanded="true"] {
      border-radius: $select-radius $select-radius 0 0;
    }
  }

  .select-dropdown, .multiple-select {
    @include select-dropdown;
  }

  .multiple-select {
    visibility: visible;
    border-radius: $select-radius;
    border: $input-border;
    position: relative;
    z-index: 0;

    .list-display {
      border-bottom: $input-border;

      ul {
        display: inline-block;
        padding: $form-spacing / 4;
        font-size: $input-font-size;
        line-height: $global-lineheight;
        li {
          display: inline-block;
          margin: $form-spacing / 4;
        }
      }
    }
    &:focus {
      border: $input-border-focus;
      outline: none;

      .list-display {
        border-bottom: $input-border-focus;
      }

      .ps-container {
        box-shadow: $input-shadow-focus;
      }
    }

    .ps-container {
      @include select-size-calc($select-multiple-size-default);

      ul {
        li {
          a {
            &:before {
              content: "";
              display: inline-block;
              font-family: FontAwesome, sans-serif;
              font-size: inherit;
              text-rendering: auto; // optimizelegibility throws things off #1094
              -webkit-font-smoothing: antialiased;
              -moz-osx-font-smoothing: grayscale;
              width: 1.5em;
              text-align: center;
              vertical-align: baseline;
            }
            &.selected:before {
              content: "\f00c";
            }
          }
        }
      }
    }
  }

  & > i.select-triangle {
    position: absolute;
    top: 0;
    right: 0;
    color: $select-triangle-color;
    padding: $form-spacing / 2;
    line-height: $global-lineheight;
    width: rem-calc($input-font-size * $global-lineheight) + $form-spacing;
    text-align: center;
    cursor: pointer;
  }

}

@mixin foundation-select {
  .select-wrapper {
    position: relative;
    select[data-select] {
      display: none;
      &[size] + .select-container .multiple-select .ps-container {
        @include select-size-calc($select-multiple-size-max);
      }
      @for $size from 1 through $select-multiple-size-max {
        &[size="#{$size}"] + .select-container .multiple-select .ps-container {
          @include select-size-calc($size);
        }
      }
    }
    .select-container {
      @include select-container;
    }
  }
}
